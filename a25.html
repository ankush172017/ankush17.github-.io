<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Haunted Lab - The Secret Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: white; font-family: 'Courier New', Courier, monospace; margin: 0; overflow: hidden; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: #050505; }
        canvas { display: block; background: #000; cursor: crosshair; }
        
        /* UI Elements */
        #dialog-box {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(0,0,0,0.85);
            border: 2px solid #500;
            padding: 20px;
            text-align: center;
            font-size: 20px;
            color: #ff4444;
            display: none;
            z-index: 100;
        }

        #inventory {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .item { width: 60px; height: 60px; background: #222; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; }
        .item.selected { border-color: red; background: #400; }

        #start-overlay {
            position: absolute;
            inset: 0;
            background: black;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        .btn { padding: 15px 40px; background: #800; color: white; border: none; font-family: 'Creepster', cursive; font-size: 30px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="mainCanvas"></canvas>
    
    <div id="dialog-box"></div>

    <div id="inventory">
        <div class="item selected" id="w0" onclick="setW(0)">üëä</div>
        <div class="item" id="w1" onclick="setW(1)">üî™</div>
        <div class="item" id="w2" onclick="setW(2)">‚öîÔ∏è</div>
        <div class="item" id="w3" onclick="setW(3)">üî´</div>
    </div>

    <div id="start-overlay">
        <h1 style="font-family: 'Creepster', cursive; font-size: 60px; color: red;">THE SECRET ROOM</h1>
        <button class="btn" onclick="startStory()">GAME START</button>
    </div>
</div>

<script>
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
const dialog = document.getElementById('dialog-box');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let phase = 'sleeping'; // sleeping, moving, hiding, action, win
let weapon = 0;
let flash = 0;
let budhiya = { x: -100, y: 300, angle: 0, health: 150, facingBack: true, active: false };
let friends = [];

// Dost (20 people) generate karna
for(let i=0; i<20; i++) {
    friends.push({
        x: 100 + Math.random() * (canvas.width - 200),
        y: 100 + Math.random() * (canvas.height - 200),
        hidden: true
    });
}

function setW(id) {
    weapon = id;
    document.querySelectorAll('.item').forEach((el, i) => {
        el.classList.toggle('selected', i === id);
    });
}

function showText(txt, time = 3000) {
    dialog.innerText = txt;
    dialog.style.display = 'block';
    setTimeout(() => { dialog.style.display = 'none'; }, time);
}

function startStory() {
    document.getElementById('start-overlay').style.display = 'none';
    
    // Scene 1: Sleeping
    showText("Aap soye hue hain...");
    setTimeout(() => {
        showText("Uncle: Utho! Wo aa rahi hai! Mere saath chalo chhupne!");
        phase = 'moving';
        setTimeout(() => {
            showText("Niche chhup jao! Shanti se baitho...");
            phase = 'hiding';
            setTimeout(startBudhiyaPhase, 4000);
        }, 3000);
    }, 3000);
}

function startBudhiyaPhase() {
    budhiya.active = true;
    budhiya.x = 50;
    phase = 'action';
    setInterval(() => {
        // Budhiya turns back and forth
        budhiya.facingBack = !budhiya.facingBack;
        if(!budhiya.facingBack) {
            showText("Budhiya: WHERE ARE YOU? Welcome to play... Hehe!");
        }
    }, 3000);
}

function drawBudhiya() {
    if(!budhiya.active) return;

    ctx.save();
    ctx.translate(budhiya.x, budhiya.y);
    
    if(budhiya.facingBack) {
        // Drawing Back
        ctx.fillStyle = "#444"; // Grey dress
        ctx.fillRect(-30, 0, 60, 150);
        ctx.fillStyle = "black"; // Long hair covering face
        ctx.fillRect(-35, -20, 70, 100);
    } else {
        // Drawing Front (Creepy Face)
        ctx.fillStyle = "#444";
        ctx.fillRect(-30, 0, 60, 150);
        ctx.fillStyle = "#d2b48c"; // Face
        ctx.beginPath(); ctx.arc(0, 0, 30, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "red"; // Glowing eyes
        ctx.fillRect(-15, -5, 8, 8); ctx.fillRect(10, -5, 8, 8);
        ctx.fillStyle = "black"; 
        ctx.beginPath(); ctx.arc(0, 15, 10, 0, Math.PI); ctx.stroke();
    }
    
    // Health bar
    ctx.fillStyle = "red";
    ctx.fillRect(-50, -60, budhiya.health * 0.6, 5);
    
    ctx.restore();

    // Movement
    if(budhiya.x < canvas.width - 100) budhiya.x += 1;
}

function draw() {
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if(phase === 'sleeping') {
        ctx.fillStyle = "#222";
        ctx.fillRect(canvas.width/2 - 100, canvas.height/2, 200, 50); // Bed
        ctx.fillStyle = "white"; ctx.fillText("üí§ Aap so rahe hain", canvas.width/2 - 50, canvas.height/2 - 20);
    }

    if(phase === 'hiding' || phase === 'action') {
        // Draw Room Floor (Bada Room)
        ctx.strokeStyle = "#111";
        for(let i=0; i<canvas.width; i+=50) ctx.strokeRect(i, 0, 50, canvas.height);

        // Draw 20 Friends (Chhupe hue)
        friends.forEach(f => {
            ctx.fillStyle = "#1a1a1a"; // Dark silhouettes
            ctx.beginPath(); ctx.arc(f.x, f.y, 15, 0, Math.PI*2); ctx.fill();
        });

        drawBudhiya();
        
        // Muzzle Flash
        if(flash > 0) {
            ctx.fillStyle = `rgba(255, 255, 0, ${flash})`;
            ctx.beginPath(); ctx.arc(mouseX, mouseY, 50, 0, Math.PI*2); ctx.fill();
            flash -= 0.1;
        }

        // Weapons in hand (Cursor)
        ctx.font = "40px Arial";
        let icons = ["üëä", "üî™", "‚öîÔ∏è", "üî´"];
        ctx.fillText(icons[weapon], mouseX - 20, mouseY + 20);
    }

    if(budhiya.health <= 0) {
        phase = 'win';
        ctx.fillStyle = "red";
        ctx.font = "60px Creepster";
        ctx.fillText("BUDHIYA MAR GAYI! AAP BACH GAYE!", canvas.width/2 - 300, canvas.height/2);
    }

    requestAnimationFrame(draw);
}

let mouseX = 0, mouseY = 0;
canvas.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });

canvas.addEventListener('mousedown', () => {
    if(phase !== 'action') return;

    if(weapon === 3) flash = 1;

    // Logic: Agar peeche mudi hai toh attack zyada hoga
    let dist = Math.hypot(mouseX - budhiya.x, mouseY - (budhiya.y + 70));
    if(dist < 100) {
        if(budhiya.facingBack) {
            let dmg = [10, 30, 60, 40][weapon];
            budhiya.health -= dmg;
            showText("CRITICAL HIT! Peeche se mara!");
        } else {
            showText("Ussne dekh liya! Attack kaam nahi kiya!");
            budhiya.x -= 20; // Wo peeche hategi
        }
    }
});

draw();
</script>

</body>
</html>
